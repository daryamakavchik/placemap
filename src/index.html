<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>ArcGIS API for JavaScript Tutorials: Display a map</title>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.24/esri/themes/light/main.css"
    />
    <link rel="stylesheet" src="./style.css" />
    <!-- <script src="./index.js" type="text/babel"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.8.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.8.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@material-ui/core@latest/umd/material-ui.development.js"></script>
    <script src="https://js.arcgis.com/4.24/"></script>
    <script>
      require([
        "esri/config",
        "esri/Map",
        "esri/views/MapView",
        "esri/Graphic",
        "esri/layers/GraphicsLayer",
        "esri/layers/FeatureLayer",
        "esri/widgets/Search",
        "esri/rest/locator",
        "esri/rest/route",
        "esri/rest/support/RouteParameters",
        "esri/rest/support/FeatureSet",
      ], function (
        esriConfig,
        Map,
        MapView,
        Graphic,
        GraphicsLayer,
        FeatureLayer,
        BasemapToggle,
        BasemapGallery,
        Search,
        locator,
        route,
        RouteParameters,
        FeatureSet
      ) {
        esriConfig.apiKey =
          "AAPKff271af86e5e4145ae46098747021260kqF_X1V0Z8FSN9TJcZbqceQjUdHGDJ11-hNCPx8t2CVvrp_Lvbd5S64hXMVFd_CO";

        const map = new Map({
          basemap: "osm-dark-gray",
        });

        const view = new MapView({
          map: map,
          center: [-118.243683, 34.052235],
          zoom: 13,
          container: "viewDiv",
        });

        const serviceUrl =
          "http://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";

        view.on("click", function (evt) {
          const params = {
            location: evt.mapPoint,
          };
          locator.locationToAddress(serviceUrl, params).then(
            function (response) {
              const address = response.address;
              showAddress(address, evt.mapPoint);
            },
            function (err) {
              showAddress("No address found.", evt.mapPoint);
            }
          );
        });

        function showAddress(address, pt) {
          view.popup.open({
            title:
              +Math.round(pt.longitude * 100000) / 100000 +
              ", " +
              Math.round(pt.latitude * 100000) / 100000,
            content: address,
            location: pt,
          });
        }

        const routeUrl =
          "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World";

        view.on("click", function (event) {
          if (view.graphics.length === 0) {
            addGraphic("origin", event.mapPoint);
          } else if (view.graphics.length === 1) {
            addGraphic("destination", event.mapPoint);

            getRoute(); // Call the route service
          } else {
            view.graphics.removeAll();
            addGraphic("origin", event.mapPoint);
          }
        });

        function addGraphic(type, point) {
          const graphic = new Graphic({
            symbol: {
              type: "simple-marker",
              color: type === "origin" ? "white" : "black",
              size: "8px",
            },
            geometry: point,
          });
          view.graphics.add(graphic);
        }

        function getRoute() {
          const routeParams = new RouteParameters({
            stops: new FeatureSet({
              features: view.graphics.toArray(),
            }),
            returnDirections: true,
          });
          route
            .solve(routeUrl, routeParams)
            .then(function (data) {
              data.routeResults.forEach(function (result) {
                result.route.symbol = {
                  type: "simple-line",
                  color: [5, 150, 255],
                  width: 3,
                };
                view.graphics.add(result.route);
              });
              if (data.routeResults.length > 0) {
                const directions = document.createElement("ol");
                directions.classList =
                  "esri-widget esri-widget--panel esri-directions__scroller";
                directions.style.marginTop = "0";
                directions.style.padding = "15px 15px 15px 30px";
                const features = data.routeResults[0].directions.features;
                features.forEach(function (result, i) {
                  const direction = document.createElement("li");
                  direction.innerHTML =
                    result.attributes.text +
                    " (" +
                    result.attributes.length.toFixed(2) +
                    " miles)";
                  directions.appendChild(direction);
                });
                view.ui.empty("top-right");
                view.ui.add(directions, "top-right");
              }
            })
            .catch(function (error) {
              console.log(error);
            });
        }

        const search = new Search({
          view: view,
        });

        view.ui.add(search, "top-left");

        const graphicsLayer = new GraphicsLayer();
        map.add(graphicsLayer);

        const point = {
          type: "point",
          longitude: -118.33987522698867,
          latitude: 34.084543364219606,
        };

        const simpleMarkerSymbol = {
          type: "simple-marker",
          color: [226, 119, 40],
          outline: {
            color: [255, 255, 255],
            width: 1,
          },
        };

        const attributes = {
          Name: "Meteora",
          Description: "restaurant",
        };

        const popupTemplate = {
          title: "{Name}",
          content: "{Description}",
        };

        const pointGraphic = new Graphic({
          geometry: point,
          symbol: simpleMarkerSymbol,
          attributes: attributes,
          popupTemplate: popupTemplate,
        });
        graphicsLayer.add(pointGraphic);
        const layer = new FeatureLayer({
          url: "https://services7.arcgis.com/JdS7wLnf7kKVAGjh/arcgis/rest/services/my_points/FeatureServer/0",
        });
        map.add(layer);
      });
    </script>
  </head>
  <body>
    <div class="overlay" id="root"></div>
      <div id="viewDiv"></div>
  </body>
</html>
